apiVersion: v1
kind: Namespace
metadata:
  name: pepr-system
  labels:
    pepr.dev: ''
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
rules:
  - apiGroups:
      - '*'
    resources:
      - '*'
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
subjects:
  - kind: ServiceAccount
    name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
    namespace: pepr-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
  namespace: pepr-system
---
apiVersion: v1
kind: Secret
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-api-token
  namespace: pepr-system
type: Opaque
data:
  value: >-
    OWJlZTM4MDUwODQzN2EwZjM3NTQ2MzZhMmFmNDQzM2U0YWIwNmRiZTA0ZDkwOTUxMTI2MjEwYzA1NTQ3OGE5Ng==
---
apiVersion: v1
kind: Secret
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-tls
  namespace: pepr-system
type: kubernetes.io/tls
data:
  tls.crt: >-
    LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tDQpNSUlDd3pDQ0FhdWdBd0lCQWdJQkFUQU5CZ2txaGtpRzl3MEJBUXNGQURBQU1CNFhEVEkwTURreE5qRXpNemcwDQpOMW9YRFRJMU1Ea3hOakV6TXpnME4xb3dBRENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DDQpnZ0VCQUpKT0pRWjh1ZVJuK0lyL0YyQVhQZFR1U2N1U0VTVjhNWjMzZ2NqVHhhdklyeVJ0NjZIK0U1RjJDNjhuDQpJbDVmbUwzZkkwY3dRcm51R1RscXJtNVVyLzI5dE8xSkorcVEzNDR1dm9oSitWcjJxVmxTa1V2ZjBrUnFyUXdsDQpUS094eHBzZnZia3RLZyt5dGJzRUIrTDBEeE5ETmh1WXdoRWIvYXc4Y0JmbkNhS3plYlNTOTA0Q3k4cjJ5cE02DQp6VmZhd1JTWFlqOWUvalBueTdndHJ3UkRyaTFNZEpOQVB5dlFWWXo1ZWxKTHRSMDRnL1oyUzkxQ2RCMkdHWlZJDQp6ZFl4eGgvS2xVZ3lXNnBiZkNadWZZVW9MQmN0RlRyQXBuMms5MEpvTHl2Q2JxdzUxSkt6UUVjNzU0azZjbDJjDQo0YXAyQm5HRTVlTURjVmVHWmx0eEhNa3hDUmNDQXdFQUFhTklNRVl3UkFZRFZSMFJCRDB3TzRJNWNHVndjaTB4DQpZMkl3TjJVMU55MWhNRFk1TFRVNFl6WXRPRGhrTmkwM1pUQXpOMlV6WVRFNE1UUXVjR1Z3Y2kxemVYTjBaVzB1DQpjM1pqTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFCTEdpdkRGZUQxSEt3SDFIblRjbzB3VG9vR1RJaE5naHhGDQpGS20yek56cDN0TFkwUVRSaWU3VnFhYzJxWHJnWFhaSk1SVEU4aUtTeDBQUWNyamc2RnQ5c0hFRWNRMlQ4eG1IDQpIb3V5QVIyZFk2dzM5dCtBQmZFbGlDRWRHNDhQRm9TaUJHM0tqUkY5TTFKY2ZoNU9Cd0o5Q0xCOTlqN0VNMkxDDQptRGgzdUhPanFvb09kem0yWFY4NHlVVlFxaW1LWkdYWmpMZEVZTEUzWkVua1krenA1QmpYU3IrbFFZaFAwR3dxDQpmbUxXUTYrNmVOZ250cEpCTWE0WG1KSkd1QUluOVdXQ3ZaMVR1Vy9wYS81T2tSWmFPd00yb3BFVDdRbHVYOFQrDQo5MXBZTUNUWk44dERMbHhjNkxaUURFOHlENE9rck9KSEljUWNzWE9FUElFQjFXT1U4OWJiDQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tDQo=
  tls.key: >-
    LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQ0KTUlJRXBBSUJBQUtDQVFFQWtrNGxCbnk1NUdmNGl2OFhZQmM5MU81Snk1SVJKWHd4bmZlQnlOUEZxOGl2Skczcg0Kb2Y0VGtYWUxyeWNpWGwrWXZkOGpSekJDdWU0Wk9XcXVibFN2L2IyMDdVa242cERmamk2K2lFbjVXdmFwV1ZLUg0KUzkvU1JHcXREQ1ZNbzdIR214Kzl1UzBxRDdLMXV3UUg0dlFQRTBNMkc1akNFUnY5ckR4d0YrY0pvck41dEpMMw0KVGdMTHl2YktrenJOVjlyQkZKZGlQMTcrTStmTHVDMnZCRU91TFV4MGswQS9LOUJWalBsNlVrdTFIVGlEOW5aTA0KM1VKMEhZWVpsVWpOMWpIR0g4cVZTREpicWx0OEptNTloU2dzRnkwVk9zQ21mYVQzUW1ndks4SnVyRG5Va3JOQQ0KUnp2bmlUcHlYWnpocW5ZR2NZVGw0d054VjRabVczRWN5VEVKRndJREFRQUJBb0lCQUFMQ1JpWWhxdnNPSk55Rw0KSSt3MEhxazBiSFY4eGRCVnBRcU1DaDZvaVAvaUhiOWc4cGU2Ni92Z1pIeFlqMmd2MkUydG9WalhKYUw0NzV2Vg0KWndCVFNOV2tRcW1vMC8rek1nRllpMCtVU1lkTmJjaHVsZjUreVg4YkhkNlpRM2FMYnluVXNaQ3czb0ZZOFlsYg0KSEVUMkxPU1ptTEhHTWRQOXhFei9xaGpMOVYxajRBMWo2ZkUzVWI4ZkUxNEpnWWFuQi8xT1ZFR21RUHd0R1pSUQ0KNENwSm1qQ0xYUkpyT2Jrb2lGYnVwN1dDUkZlNUxvWEkrTkw2Yjg0dmJXSlJ1RjFmT3NQa2p6ZldFWXUyUGRVZw0KTmNpUGpWT095cHJNdnlsSTlrenJrQjJORnlQVkh2NVA1TnBjVXJTS3QzYkVIUVFjcU8wejIvcExNZ2xPUVJGYw0KTUV2OUx2a0NnWUVBeUxJYjYxbDBtWnFQNjJ3UXpkRTd1c0JyYTBnM2I0bnl1bVJYSW9KeTNsR3BscmJUMHV0TA0KMkJLRVNqRVpybVNHaFRZcFYvbzNHbVAxRmpKTnVCcHI2TUUxUkp1Zm14M2IvRGduQ05BcWhvOUMyc2ovcUxDSg0Kb3lZZmR1Y2lQdnhmdnZQdTRuRElIS1djZEZ1bHllV29hS0t3RW5wOFUwM0luOUhEMzZEZldxa0NnWUVBdXA4Yw0KTm0yZEZYb1VaUXp6bTlyaVNLWlg1cy8zaWtzMFE0c3d1eWFMMWlWRUpEdVVyd01kUXhIckdFWVNtdWN4NUhORw0KL2VqS1dkWnpLMnN0RXEwZGJOenBIaStzUVhtRTRGblpWMWJwS1pDWE8yUmpuRU01YzJvRytrRm9KZFF2ejRPNQ0KSEtNVDUyODNZa1ZPaFEvQkUzWTNiTjkvanA5aFBjTWJhTERWWGI4Q2dZQVQyWm50VXpHM0o1Um9nbzIrN1p6cw0Kd2E5ZU13eFltZHBLR1RhTkVUM3ZRMEIweWF4MXhoUUFVUVNJbWdhaU93c2JEZHBVKzBpTDhhc0NBUU95Mjlvaw0KY1VlbGU0Ynp2cVpOY2ZoYVpNeHY5cWQwSUVFNUhBemcrQnBRbGxmS3h3ZHBTWk10RGw2Y2hyek12V3ZPWmtxYg0KM3N0dmFISDNnMC8ranE3QzVaUngwUUtCZ1FDZFdIbVpDbUpmTVVid3pESzVQWnQ4VllQWGY1RGVjUG5uMlB1Rg0KVDhLbkUxU1ltQU9NYTd2SVNOdEc1QTNidlFJNzgxWHZ6czZOWUZwS1NWci9YQ1pyR3ZjU0ZHL1A1SDA4QzRWTQ0KTm1Md1FKREI2cXB4bmR4YWl4TEcvVTZxVm5UWktkNXhYcTN4ZTd2ZWgwRGt2NXV5cFFHbU1lcUNmYTZuUEZGbg0KdTNDcVVRS0JnUUM2Vmk3aStOZnRZa1F5V0F2SERMUkowQ2J1dW5KRHUvZ0JyWi93dHI4QVBhYXFpcmtjWktzag0KYU5MZE5rT3BMVjA0YkxwTzRKakVNSVdqODZCRG1JU2VqRytqL2RVSGZzdnRNV3BMeG9USUJSSlZHMTJnVlgvaw0KSUFXWnhNVHdieDNtaVR2UTUzZzVZSTMrS2RPRHdHMHhwRE5nU1NIUzR6Yi9GVDgzUk9xSFpBPT0NCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tDQo=
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
  namespace: pepr-system
  annotations:
    pepr.dev/description: 'Pepr feature: Reconcile'
  labels:
    app: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
    pepr.dev/controller: admission
    pepr.dev/uuid: 1cb07e57-a069-58c6-88d6-7e037e3a1814
spec:
  replicas: 2
  selector:
    matchLabels:
      app: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
      pepr.dev/controller: admission
  template:
    metadata:
      annotations:
        buildTimestamp: '1726493926932'
      labels:
        app: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
        pepr.dev/controller: admission
    spec:
      terminationGracePeriodSeconds: 5
      priorityClassName: system-node-critical
      serviceAccountName: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
      securityContext:
        runAsUser: 65532
        runAsGroup: 65532
        runAsNonRoot: true
        fsGroup: 65532
      containers:
        - name: server
          image: ghcr.io/defenseunicorns/pepr/controller:v0.34.1
          imagePullPolicy: IfNotPresent
          command:
            - node
            - /app/node_modules/pepr/dist/controller.js
            - 6207484bbe3394af5c135dc84ed9c4a3deb66124a12f86a0cc79e9efe96c482a
          readinessProbe:
            httpGet:
              path: /healthz
              port: 3000
              scheme: HTTPS
          livenessProbe:
            httpGet:
              path: /healthz
              port: 3000
              scheme: HTTPS
          ports:
            - containerPort: 3000
          resources:
            requests:
              memory: 64Mi
              cpu: 100m
            limits:
              memory: 256Mi
              cpu: 500m
          env:
            - name: PEPR_WATCH_MODE
              value: 'false'
            - name: PEPR_PRETTY_LOG
              value: 'false'
            - name: LOG_LEVEL
              value: info
            - name: PEPR_RECONCILE_STRATEGY
              value: singular
          securityContext:
            runAsUser: 65532
            runAsGroup: 65532
            runAsNonRoot: true
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
          volumeMounts:
            - name: tls-certs
              mountPath: /etc/certs
              readOnly: true
            - name: api-token
              mountPath: /app/api-token
              readOnly: true
            - name: module
              mountPath: /app/load
              readOnly: true
      volumes:
        - name: tls-certs
          secret:
            secretName: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-tls
        - name: api-token
          secret:
            secretName: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-api-token
        - name: module
          secret:
            secretName: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-module
---
apiVersion: v1
kind: Service
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
  namespace: pepr-system
  labels:
    pepr.dev/controller: admission
spec:
  selector:
    app: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
    pepr.dev/controller: admission
  ports:
    - port: 443
      targetPort: 3000
---
apiVersion: v1
kind: Service
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-watcher
  namespace: pepr-system
  labels:
    pepr.dev/controller: watcher
spec:
  selector:
    app: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-watcher
    pepr.dev/controller: watcher
  ports:
    - port: 443
      targetPort: 3000
---
apiVersion: v1
kind: Secret
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-module
  namespace: pepr-system
type: Opaque
data:
  module-6207484bbe3394af5c135dc84ed9c4a3deb66124a12f86a0cc79e9efe96c482a.js.gz: >-
    H4sIAAAAAAAAE41UYW/bNhD93l+h3vJBxChGrpvElSG3gZcNwZImyFIUQ5A2lHSWWVMkR1I2DEH/faDspNkQdPsmvntH3nunuzW3UZNfFd+w9KzChVB4bbVB67fTNbeRz2OkiuSzJkYKijcItFtz2WKmaKnVQtSt5YXE7HXakyGlzS3+1QqLMRg0FnaoyLuQncESpdRJiCQWS61KITFxQtWt5BboGq0TWmWQspSNgFboSiuMH7BrNDZaIPetxSy6eUwHusLtRtvKZXe7NymsJg4oGC1FuU1Q1UJhOIdnG121IQkclq0Vfgv3dMdwWad0hRnM8tGEpSyFnoaUrGtbUWUwKov0BI9OEp4ev0uOJuVxMplUx8kJpuMTHPPRZPQWqFZn1mqbgcVgK9ANFkutV7eiQd36bJTSsnVeNxe8QBne5A06w0vMuqFCVuEaMoC+p1xu+Nad10pbfEZ02d19T4UqZVth9auQA0JRrbPu+uz65uvN2fzq4/z84uzrH7c3p7dnv/2ZwZPJfU8rNKgqVKUIogeN8CVl47dsBCG6/uUfBPjwDZ0/rKUuuHSQwZc379gJS4HCB7816A6DbwOestE4BELCc96qLdAq9OiShWxR+aSUApUfkthx6PVw09DtDI7YmI2hp7vzU4277pZSZKBME9lWRUmy0XY12BItURq0LiqliJIkSva9zg9is6kIUD8U9Zi5ZwUwShLXCo8RlxIoDDx8ExT9iBwYe3KrhP8P9kDp+2Ec7ItD4nKFm8iyOTe8EFL4bfyDqfnXcJxGvz9ZHF0ZtNxrG/kl91HDFa/RRZ+xODXGAX3+I718931PaPd5iSpb9LmjMvdx2ARUk3zWWXahaybUQscPcy5lwcvV93kUqo4OOuyjg071B53uH0hPQeoaCOX7e0g+C1KvrW6Ew1jns06ij0yOrEHPK+45C0XSMke2O2mPUxkbWlL4GQh16PcDFcehpn0oAUJ1THqqSE8oeO5WQGid+xjzGY+RjtOUUFhw54HQzXf8aMCd1BsgtNjhnV9avXnQ2rhskPTQUwgnINNFbBln82EFXnJD2LmbW+Qeqyv7yVThIybsXH18tDp+2WjCnvZY7ONFq8rQzliRYMiu+7rP1ZMtU7GI9es8HwYqsVr7pOSstB6IRd9aFek8z6FskkHL+02sSPYIDbLf1wEqYhXaskI07spWaIGQaehJy8KavRwGJxb0zt2T6avDw58ip1tb4iU3Rqj6081FPij5PzuRfXOs4ebV3+90wvZuBgAA
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-store
  namespace: pepr-system
rules:
  - apiGroups:
      - pepr.dev
    resources:
      - peprstores
    resourceNames:
      - ''
    verbs:
      - create
      - get
      - patch
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-store
  namespace: pepr-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-store
subjects:
  - kind: ServiceAccount
    name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-store
    namespace: pepr-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-watcher
  namespace: pepr-system
  annotations:
    pepr.dev/description: 'Pepr feature: Reconcile'
  labels:
    app: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-watcher
    pepr.dev/controller: watcher
    pepr.dev/uuid: 1cb07e57-a069-58c6-88d6-7e037e3a1814
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-watcher
      pepr.dev/controller: watcher
  template:
    metadata:
      annotations:
        buildTimestamp: '1726493926932'
      labels:
        app: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-watcher
        pepr.dev/controller: watcher
    spec:
      terminationGracePeriodSeconds: 5
      serviceAccountName: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814
      securityContext:
        runAsUser: 65532
        runAsGroup: 65532
        runAsNonRoot: true
        fsGroup: 65532
      containers:
        - name: watcher
          image: ghcr.io/defenseunicorns/pepr/controller:v0.34.1
          imagePullPolicy: IfNotPresent
          command:
            - node
            - /app/node_modules/pepr/dist/controller.js
            - 6207484bbe3394af5c135dc84ed9c4a3deb66124a12f86a0cc79e9efe96c482a
          readinessProbe:
            httpGet:
              path: /healthz
              port: 3000
              scheme: HTTPS
          livenessProbe:
            httpGet:
              path: /healthz
              port: 3000
              scheme: HTTPS
          ports:
            - containerPort: 3000
          resources:
            requests:
              memory: 64Mi
              cpu: 100m
            limits:
              memory: 256Mi
              cpu: 500m
          securityContext:
            runAsUser: 65532
            runAsGroup: 65532
            runAsNonRoot: true
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
          volumeMounts:
            - name: tls-certs
              mountPath: /etc/certs
              readOnly: true
            - name: module
              mountPath: /app/load
              readOnly: true
          env:
            - name: PEPR_WATCH_MODE
              value: 'true'
            - name: PEPR_PRETTY_LOG
              value: 'false'
            - name: LOG_LEVEL
              value: info
            - name: PEPR_RECONCILE_STRATEGY
              value: singular
      volumes:
        - name: tls-certs
          secret:
            secretName: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-tls
        - name: module
          secret:
            secretName: pepr-1cb07e57-a069-58c6-88d6-7e037e3a1814-module
